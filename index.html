<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FDS IAM Authorization Header Tester</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .header-info {
            background-color: #e8f4fd;
            border-color: #bee5eb;
        }
        .jwt-decode {
            background-color: #fff3cd;
            border-color: #ffeaa7;
        }
        .error {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        .success {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-success { background-color: #28a745; }
        .status-error { background-color: #dc3545; }
        .status-warning { background-color: #ffc107; }
    </style>
</head>
<body>
    <div class="container">
        <h1>FDS IAM Authorization Header Tester</h1>
        <p>This tool helps you verify that the FDS Gateway is properly adding the Authorization header with JWT token to your requests.</p>
        
        <div class="section">
            <h3>Test Status</h3>
            <div id="status">
                <span class="status-indicator status-warning"></span>
                <span>Ready to test - Click "Check Authorization Header" to begin</span>
            </div>
        </div>

        <div class="section">
            <h3>Actions</h3>
            <button onclick="checkAuthHeader()">Check Authorization Header</button>
            <button onclick="makeTestRequest()">Make Test API Request</button>
            <button onclick="clearResults()">Clear Results</button>
        </div>

        <div class="section header-info">
            <h3>Request Headers Analysis</h3>
            <div id="headerAnalysis">
                <p>No analysis performed yet. Click "Check Authorization Header" to see current request headers.</p>
            </div>
        </div>

        <div class="section jwt-decode">
            <h3>JWT Token Information</h3>
            <div id="jwtInfo">
                <p>No JWT token found yet. When the FDS Gateway forwards your request, the JWT will be decoded and displayed here.</p>
            </div>
        </div>

        <div class="section">
            <h3>Test API Response</h3>
            <div id="apiResponse">
                <p>No API requests made yet.</p>
            </div>
        </div>

        <div class="section">
            <h3>Debug Information</h3>
            <pre id="debugInfo">Application loaded at: <span id="loadTime"></span>
User Agent: <span id="userAgent"></span>
Current URL: <span id="currentUrl"></span></pre>
        </div>
    </div>

    <script>
        // Initialize page
        document.getElementById('loadTime').textContent = new Date().toISOString();
        document.getElementById('userAgent').textContent = navigator.userAgent;
        document.getElementById('currentUrl').textContent = window.location.href;

        function updateStatus(type, message) {
            const statusDiv = document.getElementById('status');
            const indicator = statusDiv.querySelector('.status-indicator');
            indicator.className = `status-indicator status-${type}`;
            statusDiv.innerHTML = `<span class="status-indicator status-${type}"></span><span>${message}</span>`;
        }

        function checkAuthHeader() {
            updateStatus('warning', 'Analyzing current request headers...');
            
            // Since we can't directly access request headers in client-side JS,
            // we'll create a comprehensive analysis based on what we can detect
            let analysis = '<h4>Header Analysis Results:</h4>';
            
            // Check if we're running through a proxy/gateway
            const isSecure = window.location.protocol === 'https:';
            const hasReferrer = document.referrer !== '';
            
            analysis += `<p><strong>Protocol:</strong> ${window.location.protocol} ${isSecure ? '✅' : '⚠️'}</p>`;
            analysis += `<p><strong>Host:</strong> ${window.location.host}</p>`;
            analysis += `<p><strong>Referrer:</strong> ${document.referrer || 'None'}</p>`;
            
            // Check for signs of proxy forwarding
            analysis += '<h5>Proxy/Gateway Detection:</h5>';
            analysis += '<p>⚠️ <em>Note: Client-side JavaScript cannot directly read HTTP request headers like Authorization. ';
            analysis += 'To properly test the FDS Gateway integration, you need a server-side endpoint that can log the received headers.</em></p>';
            
            analysis += '<h5>Recommendations:</h5>';
            analysis += '<ul>';
            analysis += '<li>Deploy a simple server-side endpoint that logs all incoming headers</li>';
            analysis += '<li>Configure the FDS Gateway to forward requests to your endpoint</li>';
            analysis += '<li>Check server logs for the Authorization: Bearer &lt;JWT&gt; header</li>';
            analysis += '</ul>';

            document.getElementById('headerAnalysis').innerHTML = analysis;
            updateStatus('warning', 'Analysis complete - Server-side testing recommended');
        }

        function makeTestRequest() {
            updateStatus('warning', 'Making test request...');
            
            // Since this is a client-side only app, we'll simulate what would happen
            // and provide guidance for actual testing
            
            const testInfo = `
                <h4>Test Request Simulation</h4>
                <p><strong>Request URL:</strong> ${window.location.href}</p>
                <p><strong>Method:</strong> GET</p>
                <p><strong>Timestamp:</strong> ${new Date().toISOString()}</p>
                
                <h5>Expected FDS Gateway Behavior:</h5>
                <ul>
                    <li>✅ Gateway should intercept this request</li>
                    <li>✅ Gateway should authenticate the user</li>
                    <li>✅ Gateway should add Authorization: Bearer &lt;JWT&gt; header</li>
                    <li>✅ Gateway should forward request to your application</li>
                </ul>
                
                <h5>For Actual Testing:</h5>
                <p>Create a simple API endpoint that returns the received headers:</p>
                <pre>
// Example Node.js/Express endpoint
app.get('/api/test', (req, res) => {
    res.json({
        headers: req.headers,
        authorization: req.headers.authorization,
        timestamp: new Date().toISOString()
    });
});
                </pre>
            `;
            
            document.getElementById('apiResponse').innerHTML = testInfo;
            updateStatus('success', 'Test request simulation complete');
        }

        function clearResults() {
            document.getElementById('headerAnalysis').innerHTML = '<p>No analysis performed yet. Click "Check Authorization Header" to see current request headers.</p>';
            document.getElementById('jwtInfo').innerHTML = '<p>No JWT token found yet. When the FDS Gateway forwards your request, the JWT will be decoded and displayed here.</p>';
            document.getElementById('apiResponse').innerHTML = '<p>No API requests made yet.</p>';
            updateStatus('warning', 'Results cleared - Ready to test');
        }

        // Function to decode JWT (for when you have actual JWT data)
        function decodeJWT(token) {
            try {
                const parts = token.split('.');
                if (parts.length !== 3) {
                    throw new Error('Invalid JWT format');
                }
                
                const header = JSON.parse(atob(parts[0]));
                const payload = JSON.parse(atob(parts[1]));
                
                return {
                    header: header,
                    payload: payload,
                    signature: parts[2]
                };
            } catch (error) {
                return { error: error.message };
            }
        }

        // If you have a JWT token to test, you can call this function
        function testJWTDecoding(jwtToken) {
            const decoded = decodeJWT(jwtToken);
            
            if (decoded.error) {
                document.getElementById('jwtInfo').innerHTML = `
                    <div class="error">
                        <h4>JWT Decoding Error</h4>
                        <p>${decoded.error}</p>
                    </div>
                `;
                return;
            }
            
            const jwtDisplay = `
                <h4>JWT Token Analysis</h4>
                <h5>Header:</h5>
                <pre>${JSON.stringify(decoded.header, null, 2)}</pre>
                
                <h5>Payload:</h5>
                <pre>${JSON.stringify(decoded.payload, null, 2)}</pre>
                
                <h5>Key Information:</h5>
                <ul>
                    <li><strong>Tenant (ECA):</strong> ${decoded.payload.tenant || 'Not specified'}</li>
                    <li><strong>User:</strong> ${decoded.payload.sub || decoded.payload.user || 'Not specified'}</li>
                    <li><strong>Roles:</strong> ${JSON.stringify(decoded.payload.roles || 'Not specified')}</li>
                    <li><strong>Permissions:</strong> ${JSON.stringify(decoded.payload.permissions || 'Not specified')}</li>
                    <li><strong>Issued At:</strong> ${decoded.payload.iat ? new Date(decoded.payload.iat * 1000).toISOString() : 'Not specified'}</li>
                    <li><strong>Expires At:</strong> ${decoded.payload.exp ? new Date(decoded.payload.exp * 1000).toISOString() : 'Not specified'}</li>
                </ul>
            `;
            
            document.getElementById('jwtInfo').innerHTML = jwtDisplay;
        }

        // Add some helpful information on page load
        window.addEventListener('load', function() {
            console.log('FDS IAM Authorization Tester loaded');
            console.log('To test with actual JWT, call: testJWTDecoding("your-jwt-token-here")');
        });
    </script>
</body>
</html>
