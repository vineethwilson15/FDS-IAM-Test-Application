<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FDS IAM Gateway Header Tester</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            position: relative;
        }
        .test-section.success {
            border-color: #28a745;
            background-color: #f8fff9;
        }
        .test-section.warning {
            border-color: #ffc107;
            background-color: #fffef0;
        }
        .test-section.error {
            border-color: #dc3545;
            background-color: #fff5f5;
        }
        .status-badge {
            position: absolute;
            top: -10px;
            right: 20px;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            color: white;
        }
        .status-success { background-color: #28a745; }
        .status-warning { background-color: #ffc107; }
        .status-error { background-color: #dc3545; }
        .status-pending { background-color: #6c757d; }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 8px;
            font-size: 14px;
            transition: background 0.3s;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }
        
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            border-left: 4px solid #007bff;
            font-size: 13px;
            line-height: 1.4;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .api-result {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            border-left: 4px solid #28a745;
        }
        
        .api-error {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            border-left: 4px solid #dc3545;
        }
        
        .header-test {
            background: #e8f4fd;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            border: 1px solid #bee5eb;
        }
        
        .test-results {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            background: #fafafa;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .endpoint-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .endpoint-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #ddd;
        }
        
        .endpoint-card h5 {
            margin: 0 0 10px 0;
            color: #333;
        }
        
        .endpoint-card p {
            margin: 5px 0;
            font-size: 14px;
            color: #666;
        }
        
        .endpoint-card button {
            width: 100%;
            margin: 5px 0;
            padding: 8px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîê FDS IAM Header Verification Tool</h1>
        <p class="subtitle">Test if FDS Gateway is adding Authorization headers to your requests</p>
        
        <!-- Real API Header Testing -->
        <div class="test-section" id="apiSection">
            <span class="status-badge status-pending">READY</span>
            <h3>üåê Public API Header Testing</h3>
            <p>Test real API calls to see if Authorization headers are being added by FDS Gateway</p>
            
            <div class="header-test">
                <h4>üéØ How This Works:</h4>
                <ul>
                    <li>When you're behind FDS Gateway, it should add <code>Authorization: Bearer &lt;JWT&gt;</code> to all outbound requests</li>
                    <li>We'll call public APIs that echo back the headers they receive</li>
                    <li>If you see Authorization headers in the response, FDS Gateway is working!</li>
                    <li>If no Authorization headers appear, you might not be behind the Gateway</li>
                </ul>
            </div>
            
            <div class="endpoint-list">
                <div class="endpoint-card">
                    <h5>üêï Dog API</h5>
                    <p>URL: https://dog.ceo/api/breeds/image/random</p>
                    <p>Returns: Random dog image</p>
                    <button onclick="testDogAPI()">Test Dog API</button>
                </div>
                
                <div class="endpoint-card">
                    <h5>üì° HTTPBin Headers</h5>
                    <p>URL: https://httpbin.org/headers</p>
                    <p>Returns: All request headers</p>
                    <button onclick="testHTTPBinHeaders()">Test Headers Echo</button>
                </div>
                
                <div class="endpoint-card">
                    <h5>üîç HTTPBin Get</h5>
                    <p>URL: https://httpbin.org/get</p>
                    <p>Returns: Complete request info</p>
                    <button onclick="testHTTPBinGet()">Test Full Request</button>
                </div>
                
                <div class="endpoint-card">
                    <h5>üìù JSONPlaceholder</h5>
                    <p>URL: https://jsonplaceholder.typicode.com/posts/1</p>
                    <p>Returns: Sample post data</p>
                    <button onclick="testJSONPlaceholder()">Test JSON API</button>
                </div>
                
                <div class="endpoint-card">
                    <h5>üé≠ ReqRes.in</h5>
                    <p>URL: https://reqres.in/api/users</p>
                    <p>Returns: User data + headers</p>
                    <button onclick="testReqRes()">Test ReqRes API</button>
                </div>
                
                <div class="endpoint-card">
                    <h5>üåü Custom Test</h5>
                    <p>Enter your own API endpoint</p>
                    <input type="text" id="customUrl" placeholder="https://your-api.com/endpoint" style="width: 100%; padding: 5px; margin: 5px 0;">
                    <button onclick="testCustomAPI()">Test Custom API</button>
                </div>
            </div>
            
            <div class="button-group">
                <button onclick="testAllAPIs()">üöÄ Test All APIs</button>
                <button onclick="testWithCustomHeaders()">üîß Test with Custom Headers</button>
                <button onclick="clearAPIResults()">üßπ Clear Results</button>
            </div>
            
            <div id="apiResults"></div>
        </div>

        <!-- Manual Header Inspection -->
        <div class="test-section" id="manualSection">
            <span class="status-badge status-pending">READY</span>
            <h3>üîç Manual Header Inspection</h3>
            <p>Manually inspect what headers are being sent with your requests</p>
            
            <div class="header-test">
                <h4>üéØ Instructions:</h4>
                <ol>
                    <li>Open your browser's Developer Tools (F12)</li>
                    <li>Go to the Network tab</li>
                    <li>Click "Test Network Request" below</li>
                    <li>Look for the request in the Network tab</li>
                    <li>Check the Request Headers for "Authorization: Bearer ..."</li>
                </ol>
            </div>
            
            <div class="button-group">
                <button onclick="testNetworkRequest()">üåê Test Network Request</button>
                <button onclick="testWithFetch()">üì° Test with Fetch API</button>
                <button onclick="testWithXHR()">üîÑ Test with XMLHttpRequest</button>
            </div>
            
            <div id="manualResults"></div>
        </div>

        <!-- FDS Gateway Detection -->
        <div class="test-section" id="gatewaySection">
            <span class="status-badge status-pending">READY</span>
            <h3>üö™ FDS Gateway Detection</h3>
            <p>Detect if you're currently behind the FDS Gateway</p>
            
            <div class="button-group">
                <button onclick="detectGateway()">üîç Detect Gateway</button>
                <button onclick="checkEnvironment()">üåç Check Environment</button>
                <button onclick="testGatewayFeatures()">‚ö° Test Gateway Features</button>
            </div>
            
            <div id="gatewayResults"></div>
        </div>

        <!-- Real-time Header Monitor -->
        <div class="test-section" id="monitorSection">
            <span class="status-badge status-pending">READY</span>
            <h3>üìä Real-time Header Monitor</h3>
            <p>Monitor headers in real-time as you make requests</p>
            
            <div class="button-group">
                <button onclick="startMonitoring()">‚ñ∂Ô∏è Start Monitoring</button>
                <button onclick="stopMonitoring()">‚èπÔ∏è Stop Monitoring</button>
                <button onclick="clearMonitor()">üßπ Clear Monitor</button>
            </div>
            
            <div class="test-results" id="headerMonitor">
                <div>Header monitor ready... Click "Start Monitoring" to begin</div>
            </div>
        </div>
    </div>

    <script>
        let monitoring = false;
        let monitorInterval;

        // Update section status
        function updateSectionStatus(sectionId, status) {
            const section = document.getElementById(sectionId);
            const badge = section.querySelector('.status-badge');
            
            section.className = `test-section ${status}`;
            badge.className = `status-badge status-${status}`;
            badge.textContent = status.toUpperCase();
        }

        // Log to results
        function logResult(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = type === 'error' ? 'api-error' : 'api-result';
            logEntry.innerHTML = `<strong>[${timestamp}]</strong> ${message}`;
            container.appendChild(logEntry);
            container.scrollTop = container.scrollHeight;
        }

        // Test Dog API
        async function testDogAPI() {
            logResult('apiResults', 'üêï Testing Dog API... <span class="loading"></span>');
            
            try {
                const response = await fetch('https://dog.ceo/api/breeds/image/random');
                const data = await response.json();
                
                // Check response headers
                const headers = {};
                for (let [key, value] of response.headers.entries()) {
                    headers[key] = value;
                }
                
                logResult('apiResults', `
                    <h5>üêï Dog API Response:</h5>
                    <p><strong>Status:</strong> ${response.status}</p>
                    <p><strong>Response:</strong> ${JSON.stringify(data, null, 2)}</p>
                    <p><strong>Response Headers:</strong></p>
                    <pre>${JSON.stringify(headers, null, 2)}</pre>
                    <p><strong>Authorization Header Check:</strong> ${headers.authorization || headers.Authorization ? '‚úÖ Found!' : '‚ùå Not found in response headers'}</p>
                    <p><em>Note: This API doesn't echo request headers back. Use HTTPBin for header inspection.</em></p>
                `);
                
                updateSectionStatus('apiSection', 'success');
            } catch (error) {
                logResult('apiResults', `‚ùå Dog API Error: ${error.message}`, 'error');
                updateSectionStatus('apiSection', 'error');
            }
        }

        // Test HTTPBin Headers (This will show us the actual headers sent)
        async function testHTTPBinHeaders() {
            logResult('apiResults', 'üì° Testing HTTPBin Headers... <span class="loading"></span>');
            
            try {
                const response = await fetch('https://httpbin.org/headers');
                const data = await response.json();
                
                const hasAuthHeader = data.headers && (data.headers.Authorization || data.headers.authorization);
                
                logResult('apiResults', `
                    <h5>üì° HTTPBin Headers Response:</h5>
                    <p><strong>Status:</strong> ${response.status}</p>
                    <p><strong>Your Request Headers (as seen by the server):</strong></p>
                    <pre>${JSON.stringify(data.headers, null, 2)}</pre>
                    <div style="background: ${hasAuthHeader ? '#d4edda' : '#f8d7da'}; padding: 10px; border-radius: 5px; margin: 10px 0;">
                        <strong>üîê Authorization Header Status:</strong> 
                        ${hasAuthHeader ? 
                            `‚úÖ FOUND! Authorization: ${data.headers.Authorization || data.headers.authorization}` : 
                            '‚ùå NOT FOUND - You may not be behind FDS Gateway'
                        }
                    </div>
                    ${hasAuthHeader ? 
                        '<p>üéâ <strong>Success!</strong> FDS Gateway is adding Authorization headers to your requests.</p>' :
                        '<p>‚ö†Ô∏è <strong>No Authorization header detected.</strong> This could mean:</p><ul><li>You\'re not behind FDS Gateway</li><li>FDS Gateway is not configured for this domain</li><li>You\'re testing from localhost/development</li></ul>'
                    }
                `);
                
                updateSectionStatus('apiSection', hasAuthHeader ? 'success' : 'warning');
            } catch (error) {
                logResult('apiResults', `‚ùå HTTPBin Headers Error: ${error.message}`, 'error');
                updateSectionStatus('apiSection', 'error');
            }
        }

        // Test HTTPBin Get (Full request info)
        async function testHTTPBinGet() {
            logResult('apiResults', 'üîç Testing HTTPBin Get... <span class="loading"></span>');
            
            try {
                const response = await fetch('https://httpbin.org/get');
                const data = await response.json();
                
                const hasAuthHeader = data.headers && (data.headers.Authorization || data.headers.authorization);
                
                logResult('apiResults', `
                    <h5>üîç HTTPBin Get Response:</h5>
                    <p><strong>Status:</strong> ${response.status}</p>
                    <p><strong>Request URL:</strong> ${data.url}</p>
                    <p><strong>Request Headers:</strong></p>
                    <pre>${JSON.stringify(data.headers, null, 2)}</pre>
                    <p><strong>Request Args:</strong></p>
                    <pre>${JSON.stringify(data.args, null, 2)}</pre>
                    <div style="background: ${hasAuthHeader ? '#d4edda' : '#f8d7da'}; padding: 10px; border-radius: 5px; margin: 10px 0;">
                        <strong>üîê Authorization Header:</strong> 
                        ${hasAuthHeader ? 
                            `‚úÖ ${data.headers.Authorization || data.headers.authorization}` : 
                            '‚ùå No Authorization header found'
                        }
                    </div>
                `);
                
                updateSectionStatus('apiSection', hasAuthHeader ? 'success' : 'warning');
            } catch (error) {
                logResult('apiResults', `‚ùå HTTPBin Get Error: ${error.message}`, 'error');
                updateSectionStatus('apiSection', 'error');
            }
        }

        // Test JSONPlaceholder
        async function testJSONPlaceholder() {
            logResult('apiResults', 'üìù Testing JSONPlaceholder... <span class="loading"></span>');
            
            try {
                const response = await fetch('https://jsonplaceholder.typicode.com/posts/1');
                const data = await response.json();
                
                logResult('apiResults', `
                    <h5>üìù JSONPlaceholder Response:</h5>
                    <p><strong>Status:</strong> ${response.status}</p>
                    <p><strong>Response:</strong></p>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                    <p><em>Note: This API doesn't echo request headers. Check browser DevTools Network tab to see actual headers sent.</em></p>
                `);
                
                updateSectionStatus('apiSection', 'success');
            } catch (error) {
                logResult('apiResults', `‚ùå JSONPlaceholder Error: ${error.message}`, 'error');
                updateSectionStatus('apiSection', 'error');
            }
        }

        // Test ReqRes.in
        async function testReqRes() {
            logResult('apiResults', 'üé≠ Testing ReqRes.in... <span class="loading"></span>');
            
            try {
                const response = await fetch('https://reqres.in/api/users?page=1');
                const data = await response.json();
                
                logResult('apiResults', `
                    <h5>üé≠ ReqRes.in Response:</h5>
                    <p><strong>Status:</strong> ${response.status}</p>
                    <p><strong>Response:</strong></p>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                    <p><em>Note: This API doesn't echo request headers. Use HTTPBin for header inspection.</em></p>
                `);
                
                updateSectionStatus('apiSection', 'success');
            } catch (error) {
                logResult('apiResults', `‚ùå ReqRes.in Error: ${error.message}`, 'error');
                updateSectionStatus('apiSection', 'error');
            }
        }

        // Test Custom API
        async function testCustomAPI() {
            const url = document.getElementById('customUrl').value.trim();
            if (!url) {
                logResult('apiResults', '‚ùå Please enter a custom API URL', 'error');
                return;
            }
            
            logResult('apiResults', `üåü Testing Custom API: ${url}... <span class="loading"></span>`);
            
            try {
                const response = await fetch(url);
                const data = await response.json();
                
                logResult('apiResults', `
                    <h5>üåü Custom API Response:</h5>
                    <p><strong>URL:</strong> ${url}</p>
                    <p><strong>Status:</strong> ${response.status}</p>
                    <p><strong>Response:</strong></p>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `);
                
                updateSectionStatus('apiSection', 'success');
            } catch (error) {
                logResult('apiResults', `‚ùå Custom API Error: ${error.message}`, 'error');
                updateSectionStatus('apiSection', 'error');
            }
        }

        // Test All APIs
        async function testAllAPIs() {
            logResult('apiResults', 'üöÄ Testing all APIs...');
            updateSectionStatus('apiSection', 'warning');
            
            await testHTTPBinHeaders();
            await new Promise(resolve => setTimeout(resolve, 1000));
            await testHTTPBinGet();
            await new Promise(resolve => setTimeout(resolve, 1000));
            await testDogAPI();
            await new Promise(resolve => setTimeout(resolve, 1000));
            await testJSONPlaceholder();
            await new Promise(resolve => setTimeout(resolve, 1000));
            await testReqRes();
            
            logResult('apiResults', '‚úÖ All API tests completed!');
        }

        // Test with Custom Headers
        async function testWithCustomHeaders() {
            logResult('apiResults', 'üîß Testing with custom headers... <span class="loading"></span>');
            
            try {
                const response = await fetch('https://httpbin.org/headers', {
                    headers: {
                        'X-Test-Header': 'FDS-IAM-Test',
                        'X-Custom-Auth': 'Bearer custom-token',
                        'User-Agent': 'FDS-IAM-Tester/1.0'
                    }
                });
                const data = await response.json();
                
                logResult('apiResults', `
                    <h5>üîß Custom Headers Test:</h5>
                    <p><strong>Status:</strong> ${response.status}</p>
                    <p><strong>Headers sent to server:</strong></p>
                    <pre>${JSON.stringify(data.headers, null, 2)}</pre>
                    <p><strong>Custom headers check:</strong></p>
                    <ul>
                        <li>X-Test-Header: ${data.headers['X-Test-Header'] ? '‚úÖ Found' : '‚ùå Not found'}</li>
                        <li>X-Custom-Auth: ${data.headers['X-Custom-Auth'] ? '‚úÖ Found' : '‚ùå Not found'}</li>
                        <li>Authorization (from FDS): ${data.headers.Authorization || data.headers.authorization ? '‚úÖ Found' : '‚ùå Not found'}</li>
                    </ul>
                `);
                
                updateSectionStatus('apiSection', 'success');
            } catch (error) {
                logResult('apiResults', `‚ùå Custom Headers Error: ${error.message}`, 'error');
                updateSectionStatus('apiSection', 'error');
            }
        }

        // Clear API Results
        function clearAPIResults() {
            document.getElementById('apiResults').innerHTML = '';
            updateSectionStatus('apiSection', 'pending');
        }

        // Test Network Request
        function testNetworkRequest() {
            logResult('manualResults', 'üåê Making network request... Check DevTools Network tab!');
            
            fetch('https://httpbin.org/get?test=network-inspection')
                .then(response => response.json())
                .then(data => {
                    logResult('manualResults', `
                        <h5>üåê Network Request Complete:</h5>
                        <p><strong>‚úÖ Request sent successfully!</strong></p>
                        <p><strong>Instructions:</strong></p>
                        <ol>
                            <li>Open DevTools (F12)</li>
                            <li>Go to Network tab</li>
                            <li>Find the request to "httpbin.org/get"</li>
                            <li>Click on it to see details</li>
                            <li>Check "Request Headers" section</li>
                            <li>Look for "Authorization: Bearer ..." header</li>
                        </ol>
                        <p><strong>Response data:</strong></p>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `);
                    updateSectionStatus('manualSection', 'success');
                })
                .catch(error => {
                    logResult('manualResults', `‚ùå Network request failed: ${error.message}`, 'error');
                    updateSectionStatus('manualSection', 'error');
                });
        }

        // Test with Fetch API
        function testWithFetch() {
            logResult('manualResults', 'üì° Testing with Fetch API...');
            
            fetch('https://httpbin.org/post', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Test-Method': 'Fetch-API'
                },
                body: JSON.stringify({
                    test: 'fetch-api-test',
                    timestamp: new Date().toISOString()
                })
            })
            .then(response => response.json())
            .then(data => {
                logResult('manualResults', `
                    <h5>üì° Fetch API Test:</h5>
                    <p><strong>Method:</strong> POST</p>
                    <p><strong>Request Headers:</strong></p>
                    <pre>${JSON.stringify(data.headers, null, 2)}</pre>
                    <p><strong>Request Body:</strong></p>
                    <pre>${JSON.stringify(data.json, null, 2)}</pre>
                    <p><strong>Authorization Header:</strong> ${data.headers.Authorization || data.headers.authorization || 'Not found'}</p>
                `);
                updateSectionStatus('manualSection', 'success');
            })
            .catch(error => {
                logResult('manualResults', `‚ùå Fetch API error: ${error.message}`, 'error');
                updateSectionStatus('manualSection', 'error');
            });
        }

        // Test with XMLHttpRequest
        function testWithXHR() {
            logResult('manualResults', 'üîÑ Testing with XMLHttpRequest...');
            
            const xhr = new XMLHttpRequest();
            xhr.open('GET', 'https://httpbin.org/get?method=xhr', true);
            xhr.setRequestHeader('X-Test-Method', 'XMLHttpRequest');
            
            xhr.onload = function() {
                if (xhr.status === 200) {
                    const data = JSON.parse(xhr.responseText);
                    logResult('manualResults', `
                        <h5>üîÑ XMLHttpRequest Test:</h5>
                        <p><strong>Status:</strong> ${xhr.status}</p>
                        <p><strong>Request Headers:</strong></p>
                        <pre>${JSON.stringify(data.headers, null, 2)}</pre>
                        <p><strong>Authorization Header:</strong> ${data.headers.Authorization || data.headers.authorization || 'Not found'}</p>
                    `);
                    updateSectionStatus('manualSection', 'success');
                } else {
                    logResult('manualResults', `‚ùå XMLHttpRequest failed: ${xhr.status}`, 'error');
                    updateSectionStatus('manualSection', 'error');
                }
            };
            
            xhr.onerror = function() {
                logResult('manualResults', '‚ùå XMLHttpRequest error occurred', 'error');
                updateSectionStatus('manualSection', 'error');
            };
            
            xhr.send();
        }

        // Detect Gateway
        function detectGateway() {
            logResult('gatewayResults', 'üîç Detecting FDS Gateway...');
            updateSectionStatus('gatewaySection', 'warning');
            
            // Check for common gateway indicators
            const indicators = {
                protocol: window.location.protocol === 'https:',
                host: window.location.host,
                userAgent: navigator.userAgent,
                referrer: document.referrer,
                cookies: document.cookie
            };
            
            // Test for gateway-specific headers by making a request
            fetch('https://httpbin.org/headers')
                .then(response => response.json())
                .then(data => {
                    const headers = data.headers;
                    const gatewayIndicators = [];
                    
                    // Check for common gateway headers
                    if (headers['X-Forwarded-For']) gatewayIndicators.push('‚úÖ X-Forwarded-For header detected');
                    if (headers['X-Forwarded-Proto']) gatewayIndicators.push('‚úÖ X-Forwarded-Proto header detected');
                    if (headers['X-Real-IP']) gatewayIndicators.push('‚úÖ X-Real-IP header detected');
                    if (headers['Authorization']) gatewayIndicators.push('‚úÖ Authorization header detected');
                    if (headers['X-FDS-Tenant'] || headers['X-FDS-User']) gatewayIndicators.push('‚úÖ FDS-specific headers detected');
                    
                    const isLikelyBehindGateway = gatewayIndicators.length > 0;
                    
                    logResult('gatewayResults', `
                        <h5>üîç Gateway Detection Results:</h5>
                        <div style="background: ${isLikelyBehindGateway ? '#d4edda' : '#f8d7da'}; padding: 10px; border-radius: 5px; margin: 10px 0;">
                            <strong>Gateway Status:</strong> ${isLikelyBehindGateway ? '‚úÖ Likely behind a gateway' : '‚ùå Not detected'}
                        </div>
                        <p><strong>Gateway Indicators:</strong></p>
                        <ul>
                            ${gatewayIndicators.length > 0 ? gatewayIndicators.map(indicator => `<li>${indicator}</li>`).join('') : '<li>‚ùå No gateway indicators found</li>'}
                        </ul>
                        <p><strong>All Request Headers:</strong></p>
                        <pre>${JSON.stringify(headers, null, 2)}</pre>
                    `);
                    
                    updateSectionStatus('gatewaySection', isLikelyBehindGateway ? 'success' : 'warning');
                })
                .catch(error => {
                    logResult('gatewayResults', `‚ùå Gateway detection failed: ${error.message}`, 'error');
                    updateSectionStatus('gatewaySection', 'error');
                });
        }

        // Check Environment
        function checkEnvironment() {
            logResult('gatewayResults', 'üåç Checking environment...');
            
            const env = {
                url: window.location.href,
                protocol: window.location.protocol,
                host: window.location.host,
                pathname: window.location.pathname,
                search: window.location.search,
                hash: window.location.hash,
                referrer: document.referrer || 'Direct access',
                userAgent: navigator.userAgent,
                language: navigator.language,
                cookieEnabled: navigator.cookieEnabled,
                onLine: navigator.onLine,
                timestamp: new Date().toISOString()
            };
            
            logResult('gatewayResults', `
                <h5>üåç Environment Information:</h5>
                <pre>${JSON.stringify(env, null, 2)}</pre>
                <p><strong>FDS Gateway Compatibility:</strong></p>
                <ul>
                    <li>${env.protocol === 'https:' ? '‚úÖ' : '‚ùå'} HTTPS Protocol</li>
                    <li>${env.cookieEnabled ? '‚úÖ' : '‚ùå'} Cookies Enabled</li>
                    <li>${env.onLine ? '‚úÖ' : '‚ùå'} Online Status</li>
                    <li>${env.referrer !== 'Direct access' ? '‚úÖ' : '‚ö†Ô∏è'} Referrer Present</li>
                </ul>
            `);
            
            updateSectionStatus('gatewaySection', 'success');
        }

        // Test Gateway Features
        function testGatewayFeatures() {
            logResult('gatewayResults', '‚ö° Testing gateway features...');
            
            // Test session management
            const sessionTest = sessionStorage.getItem('fds-test') || 'not-set';
            sessionStorage.setItem('fds-test', new Date().toISOString());
            
            // Test cookie handling
            const cookieTest = document.cookie.includes('fds-test');
            document.cookie = 'fds-test=true; path=/';
            
            logResult('gatewayResults', `
                <h5>‚ö° Gateway Features Test:</h5>
                <p><strong>Session Storage:</strong> ${sessionTest !== 'not-set' ? '‚úÖ Working' : '‚ö†Ô∏è First time'}</p>
                <p><strong>Cookie Support:</strong> ${navigator.cookieEnabled ? '‚úÖ Enabled' : '‚ùå Disabled'}</p>
                <p><strong>Local Storage:</strong> ${typeof(Storage) !== 'undefined' ? '‚úÖ Available' : '‚ùå Not available'}</p>
                <p><strong>HTTPS:</strong> ${window.location.protocol === 'https:' ? '‚úÖ Secure' : '‚ùå Not secure'}</p>
                <p><strong>Cross-Origin Requests:</strong> Testing...</p>
            `);
            
            // Test CORS
            fetch('https://httpbin.org/get', { mode: 'cors' })
                .then(response => {
                    logResult('gatewayResults', '‚úÖ CORS requests working');
                    updateSectionStatus('gatewaySection', 'success');
                })
                .catch(error => {
                    logResult('gatewayResults', `‚ùå CORS test failed: ${error.message}`, 'error');
                    updateSectionStatus('gatewaySection', 'warning');
                });
        }

        // Start Monitoring
        function startMonitoring() {
            if (monitoring) return;
            
            monitoring = true;
            logResult('headerMonitor', '‚ñ∂Ô∏è Starting header monitoring...');
            
            // Monitor every 5 seconds
            monitorInterval = setInterval(() => {
                fetch('https://httpbin.org/headers')
                    .then(response => response.json())
                    .then(data => {
                        const timestamp = new Date().toLocaleTimeString();
                        const authHeader = data.headers.Authorization || data.headers.authorization;
                        
                        logResult('headerMonitor', `
                            <strong>[${timestamp}] Header Check:</strong>
                            ${authHeader ? `üîê Auth: ${authHeader.substring(0, 20)}...` : '‚ùå No auth header'}
                        `);
                    })
                    .catch(error => {
                        logResult('headerMonitor', `‚ùå Monitor error: ${error.message}`, 'error');
                    });
            }, 5000);
            
            updateSectionStatus('monitorSection', 'success');
        }

        // Stop Monitoring
        function stopMonitoring() {
            if (!monitoring) return;
            
            monitoring = false;
            clearInterval(monitorInterval);
            logResult('headerMonitor', '‚èπÔ∏è Monitoring stopped');
            updateSectionStatus('monitorSection', 'pending');
        }

        // Clear Monitor
        function clearMonitor() {
            document.getElementById('headerMonitor').innerHTML = '<div>Header monitor cleared...</div>';
        }

        // Initialize
        window.addEventListener('load', function() {
            console.log('FDS IAM Header Verification Tool loaded');
            console.log('Ready to test header forwarding from FDS Gateway');
        });
    </script>
</body>
</html>
